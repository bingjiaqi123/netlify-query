<view class="quest-container">
  <!-- ç¬¬ä¸€è¡Œï¼šè¿”å›æŒ‰é’®å’Œæˆ‘æ˜¯å®¶é•¿æŒ‰é’® -->
  <view class="top-row">
    <button class="back-btn" bindtap="goBack">è¿”å›</button>
    <button class="parent-btn {{isParentMode ? 'active' : ''}}" bindtap="toggleMode">{{isParentMode ? 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' : 'æˆ‘æ˜¯å®¶é•¿'}}</button>
  </view>

  <!-- å­¦ç”Ÿæ¨¡å¼ï¼šæ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨ -->
  <view class="student-mode" wx:if="{{!isParentMode}}">
    <!-- ç¬¬äºŒè¡Œï¼šä¸‰ä¸ªæ ‡ç­¾é¡µ -->
    <view class="tabs-container">
      <view class="tabs">
        <view class="tab {{activeTab==='daily'?'active':''}}" data-tab="daily" bindtap="switchTab">
          <image class="redraw-btn" src="../../images/rechoose.png" 
                 data-tip="{{canRedrawDaily ? 'ç‚¹å‡»é‡æŠ½æ¯æ—¥ä»»åŠ¡' : 'ä»Šæ—¥é‡æŠ½æ¬¡æ•°å·²ç”¨å®Œ'}}"
                 data-disabled="{{!canRedrawDaily}}"
                 catchtap="redrawDailyTasks" />
          <text>æ¯æ—¥ä»»åŠ¡</text>
        </view>
        <view class="tab {{activeTab==='weekly'?'active':''}}" data-tab="weekly" bindtap="switchTab">
          <image class="redraw-btn" src="../../images/rechoose.png" 
                 data-tip="{{canRedrawWeekly ? 'ç‚¹å‡»é‡æŠ½æ¯å‘¨ä»»åŠ¡' : 'æœ¬å‘¨é‡æŠ½æ¬¡æ•°å·²ç”¨å®Œ'}}"
                 data-disabled="{{!canRedrawWeekly}}"
                 catchtap="redrawWeeklyTasks" />
          <text>æ¯å‘¨ä»»åŠ¡</text>
      </view>
      <text class="tab {{activeTab==='event'?'active':''}}" data-tab="event" bindtap="switchTab">æ´»åŠ¨ä»»åŠ¡</text>
      </view>
    </view>

    <!-- æ¨ªå¹…åŒºåŸŸ -->
    <view class="banner-container" wx:if="{{activeTab==='daily'}}">
      <view class="daily-banner">
        <view class="banner-icon">
          <view class="date-box">{{dailyBanner.date}}</view>
        </view>
        <view class="banner-content">
          <text class="banner-quote">{{dailyBanner.quote}}</text>
        </view>
      </view>
    </view>

    <view class="banner-container" wx:if="{{activeTab==='weekly'}}">
      <view class="weekly-banner">
        <view class="banner-icon">
          <image src="{{'../../images/week/' + weeklyBanner.weekdayIcon}}" class="weekday-icon" mode="aspectFit" />
        </view>
        <view class="banner-content">
          <text class="banner-quote">{{weeklyBanner.quote}}</text>
        </view>
      </view>
    </view>

    <!-- æ¯æ—¥ä»»åŠ¡å’Œæ¯å‘¨ä»»åŠ¡ï¼šæ˜¾ç¤ºä»»åŠ¡æ± æŒ‰é’®å’Œä»»åŠ¡åˆ—è¡¨ -->
    <view wx:if="{{activeTab==='daily' || activeTab==='weekly'}}">
      
      <!-- ä»»åŠ¡åˆ—è¡¨ -->
      <view class="list">
      <block wx:for="{{visibleTasks}}" wx:key="id">
        <view class="task {{item.status==='pending-review'?'pending':''}}">
          <view class="task-content">
            <text class="title">{{item.title}}</text>
            <view class="desc-container">
              <text class="desc">{{item.desc}}</text>
            </view>
            <view class="rewards">
              <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
              <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
              <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
            </view>
          </view>
          <view class="task-actions">
            <block wx:if="{{item.status==='pending-review'}}">
              <text class="waiting">æ­£åœ¨ç­‰å¾…å®¡æ ¸â€¦</text>
            </block>
            <block wx:else>
              <button class="submit" data-id="{{item.id}}" bindtap="submitTask">æäº¤</button>
            </block>
          </view>
        </view>
      </block>
    </view>
    </view>

    <!-- æ´»åŠ¨ï¼šä¿æŒåŸæœ‰çš„æ¥å–ã€è¿›è¡Œä¸­æµç¨‹ -->
    <view wx:if="{{activeTab==='event'}}">
      <view class="subtabs">
        <button class="subtab {{activeSub==='available'?'active':''}}" data-sub="available" bindtap="switchSub">å¾…æ¥å–</button>
        <button class="subtab {{activeSub==='ongoing'?'active':''}}" data-sub="ongoing" bindtap="switchSub">è¿›è¡Œä¸­</button>
      </view>

      <view class="list">
        <block wx:for="{{visibleTasks}}" wx:key="id">
          <view class="task {{item.status==='pending-review'?'pending':''}}">
            <view class="task-content">
              <text class="title">{{item.title}}</text>
              <view class="desc-container">
                <text class="desc">{{item.desc}}</text>
              </view>
              <view class="rewards">
                <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
                <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
                <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
              </view>
              <text wx:if="{{activeSub==='ongoing' && item.acceptTimeText}}" class="task-time">æ¥å–æ—¶é—´ï¼š{{item.acceptTimeText}}</text>
            </view>
            <view class="task-actions">
              <block wx:if="{{activeSub==='available'}}">
                <button class="accept" data-id="{{item.id}}" bindtap="acceptTask">æ¥å–</button>
              </block>
              <block wx:elif="{{activeSub==='ongoing'}}">
                <block wx:if="{{item.status==='pending-review'}}">
                  <text class="waiting">æ­£åœ¨ç­‰å¾…å®¡æ ¸â€¦</text>
                </block>
                <block wx:else>
                  <button class="submit" data-id="{{item.id}}" bindtap="submitTask">æäº¤</button>
                  <button class="abandon" data-id="{{item.id}}" bindtap="abandonTask">æ”¾å¼ƒ</button>
                </block>
              </block>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- å®¶é•¿æ¨¡å¼ï¼šæ˜¾ç¤ºä»»åŠ¡ç®¡ç† -->
  <view class="parent-mode" wx:if="{{isParentMode}}">
    <!-- ä¸‰ä¸ªå­é¡µé¢æ ‡ç­¾ -->
    <view class="tabs">
      <text class="tab {{activeTab==='daily'?'active':''}}" data-tab="daily" bindtap="switchParentTab">æ¯æ—¥ä»»åŠ¡</text>
      <text class="tab {{activeTab==='weekly'?'active':''}}" data-tab="weekly" bindtap="switchParentTab">æ¯å‘¨ä»»åŠ¡</text>
      <text class="tab {{activeTab==='event'?'active':''}}" data-tab="event" bindtap="switchParentTab">æ´»åŠ¨ä»»åŠ¡</text>
    </view>

    <!-- æ¨ªå¹…åŒºåŸŸ -->
    <view class="banner-container" wx:if="{{activeTab==='daily'}}">
      <view class="daily-banner">
        <view class="banner-icon">
          <view class="date-box">{{dailyBanner.date}}</view>
        </view>
        <view class="banner-content">
          <text class="banner-quote">{{dailyBanner.quote}}</text>
        </view>
      </view>
    </view>

    <view class="banner-container" wx:if="{{activeTab==='weekly'}}">
      <view class="weekly-banner">
        <view class="banner-icon">
          <image src="{{'../../images/week/' + weeklyBanner.weekdayIcon}}" class="weekday-icon" mode="aspectFit" />
        </view>
        <view class="banner-content">
          <text class="banner-quote">{{weeklyBanner.quote}}</text>
        </view>
      </view>
    </view>
    
    <!-- ä»»åŠ¡æ± é€‰æ‹© -->
    <view class="pool-selector" wx:if="{{activeTab==='daily' || activeTab==='weekly'}}">
      <view class="pool-tabs">
        <view class="pool-tab {{activePool==='permanent' ? 'active' : ''}}" data-pool="permanent" bindtap="navigateToPermanentPool">
          <text>å¸¸é©»ä»»åŠ¡æ± </text>
        </view>
        <view class="pool-tab {{activePool==='random' ? 'active' : ''}}" data-pool="random" bindtap="navigateToRandomPool">
          <text>éšæœºä»»åŠ¡æ± </text>
        </view>
      </view>
    </view>

    <!-- æ¯æ—¥ä»»åŠ¡å’Œæ¯å‘¨ä»»åŠ¡ï¼šåˆ†æˆä¸¤éƒ¨åˆ†æ˜¾ç¤º -->
    <view wx:if="{{activeTab==='daily' || activeTab==='weekly'}}">
      <!-- å·²æäº¤å¾…å®¡æ ¸æ ‡é¢˜å’Œå‘å¸ƒä»»åŠ¡æŒ‰é’® -->
      <view class="header-row">
        <text class="section-title">å·²æäº¤å¾…å®¡æ ¸</text>
        <button class="publish-task-btn" bindtap="showPublishPanel">å‘å¸ƒä»»åŠ¡</button>
      </view>
      
      <!-- å·²æäº¤å¾…å®¡æ ¸çš„ä»»åŠ¡ -->
      <view class="task-list">
        <block wx:for="{{pendingReviewTasks}}" wx:key="id">
          <view class="manage-task-card">
            <view class="task-content">
              <view class="task-header">
                <text class="task-title">{{item.title}}</text>
              </view>
              <view class="task-desc">{{item.desc}}</view>
              <view class="task-meta">
                <view class="task-rewards">
                  <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
                  <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
                  <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
                </view>
              </view>
              <view class="task-time-row" wx:if="{{item.submitTimeText}}">
                <text class="task-time">{{'æäº¤æ—¶é—´ï¼š' + item.submitTimeText}}</text>
              </view>
            </view>
            <view class="task-actions">
              <view class="review-row">
                <button class="approve-round" data-id="{{item.id}}" bindtap="approveTask">ğŸ‘</button>
              </view>
              <view class="review-row">
                <input class="score-input" type="number" placeholder="100" data-id="{{item.id}}" bindinput="onScoreInput"/>
              </view>
            </view>
          </view>
        </block>
        <view wx:if="{{!pendingReviewTasks || pendingReviewTasks.length === 0}}" class="empty-tip">æš‚æ— å¾…å®¡æ ¸ä»»åŠ¡</view>
      </view>
    </view>

    <!-- æˆå°±ï¼šåˆ†æˆä¸¤éƒ¨åˆ†æ˜¾ç¤º -->
    <view wx:if="{{activeTab==='achieve'}}">
      <!-- å·²æäº¤å¾…å®¡æ ¸çš„æˆå°± -->
      <view class="section-title">å·²æäº¤å¾…å®¡æ ¸</view>
      <view class="task-list">
        <block wx:for="{{pendingReviewTasks}}" wx:key="id">
          <view class="manage-task-card">
            <view class="task-content">
              <view class="task-header">
                <text class="task-title">{{item.title}}</text>
              </view>
              <view class="task-desc">{{item.desc}}</view>
              <view class="task-meta">
                <view class="task-rewards">
                  <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
                  <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
                  <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
                </view>
              </view>
              <view class="task-time-row" wx:if="{{item.submitTimeText}}">
                <text class="task-time">{{'æäº¤æ—¶é—´ï¼š' + item.submitTimeText}}</text>
              </view>
            </view>
            <view class="task-actions">
              <view class="review-row">
                <button class="approve-round" data-id="{{item.id}}" bindtap="approveTask">ğŸ‘</button>
              </view>
              <view class="review-row">
                <input class="score-input" type="number" placeholder="100" data-id="{{item.id}}" bindinput="onScoreInput"/>
              </view>
            </view>
          </view>
        </block>
        <view wx:if="{{!pendingReviewTasks || pendingReviewTasks.length === 0}}" class="empty-tip">æš‚æ— å¾…å®¡æ ¸æˆå°±</view>
      </view>

      <!-- æœªæäº¤çš„æˆå°± -->
      <view class="section-title">æœªæäº¤æˆå°±</view>
      <view class="task-list">
        <block wx:for="{{availableTasks}}" wx:key="id">
          <view class="manage-task-card">
            <view class="task-content">
              <view class="task-header">
                <text class="task-title">{{item.title}}</text>
              </view>
              <view class="task-desc">{{item.desc}}</view>
              <view class="task-meta">
                <view class="task-rewards">
                  <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
                  <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
                  <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
                </view>
              </view>
              <view class="task-time-row" wx:if="{{item.publishTimeText}}">
                <text class="task-time">{{'å‘å¸ƒæ—¶é—´ï¼š' + item.publishTimeText}}</text>
              </view>
            </view>
            <view class="task-actions">
              <button class="delete-btn" data-id="{{item.id}}" bindtap="deleteTask">ğŸ—‘ï¸</button>
            </view>
          </view>
        </block>
        <view wx:if="{{!availableTasks || availableTasks.length === 0}}" class="empty-tip">æš‚æ— æœªæäº¤æˆå°±</view>
      </view>
    </view>

    <!-- æ´»åŠ¨ï¼šä¿æŒåŸæœ‰çš„æ˜¾ç¤ºæ–¹å¼ -->
    <view wx:if="{{activeTab==='event'}}">
      <!-- ç®¡ç†ç°æœ‰ä»»åŠ¡æ ‡é¢˜å’Œå‘å¸ƒä»»åŠ¡æŒ‰é’® -->
      <view class="header-row">
        <text class="section-title">ç®¡ç†ç°æœ‰ä»»åŠ¡</text>
        <button class="publish-task-btn" bindtap="showPublishPanel">å‘å¸ƒä»»åŠ¡</button>
      </view>
      
      <view class="task-list">
        <block wx:for="{{manageTasks}}" wx:key="id">
          <view class="manage-task-card">
            <view class="task-content">
              <view class="task-header">
                <text class="task-title">{{item.title}}</text>
                <text class="task-status {{item.status}}">{{item.status === 'pending-review' ? 'å¾…å®¡æ ¸' : item.status === 'approved' ? 'å·²é€šè¿‡' : item.status === 'ongoing' ? 'è¿›è¡Œä¸­' : 'å¾…æ¥å–'}}</text>
              </view>
              <view class="task-desc">{{item.desc}}</view>
              <view class="task-meta">
                <view class="task-rewards">
                  <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
                  <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
                  <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
                </view>
              </view>
              <view class="task-time-row" wx:if="{{item.publishTimeText}}">
                <text class="task-time">{{'å‘å¸ƒæ—¶é—´ï¼š' + item.publishTimeText}}</text>
              </view>
            </view>
            <view class="task-actions">
              <block wx:if="{{item.status === 'pending-review'}}">
                <view class="review-row">
                  <button class="approve-round" data-id="{{item.id}}" bindtap="approveTask">ğŸ‘</button>
                </view>
                <view class="review-row">
                  <input class="score-input" type="number" placeholder="100" data-id="{{item.id}}" bindinput="onScoreInput"/>
                </view>
              </block>
              <block wx:else>
                <button class="edit-btn" data-id="{{item.id}}" bindtap="editTask">ğŸ–Šï¸</button>
                <button class="delete-btn" data-id="{{item.id}}" bindtap="deleteTask">ğŸ—‘ï¸</button>
              </block>
            </view>
          </view>
        </block>
        <view wx:if="{{!manageTasks || manageTasks.length === 0}}" class="empty-tip">æš‚æ— ä»»åŠ¡</view>
      </view>
    </view>
    </view>

  <!-- å‘å¸ƒä»»åŠ¡é¢æ¿ -->
  <view class="publish-panel {{showPublishPanel ? 'show' : ''}}" wx:if="{{showPublishPanel}}" catchtouchmove>
    <view class="panel-content">
      <view class="panel-header">
        <text class="panel-title">å‘å¸ƒä»»åŠ¡</text>
        <view class="header-actions">
          <button class="cancel-btn" bindtap="hidePublishPanel">å–æ¶ˆ</button>
          <button class="publish-btn" bindtap="publishTask">å‘å¸ƒ</button>
        </view>
      </view>
      
      <view class="input-group">
        <!-- æ¯æ—¥ä»»åŠ¡IDè¾“å…¥å’Œä»»åŠ¡ç±»å‹å¼€å…³ï¼ˆä»…æ¯æ—¥ä»»åŠ¡æ˜¾ç¤ºï¼‰ -->
        <view class="input-section" wx:if="{{activeTab==='daily'}}">
          <view class="id-switch-row">
            <view class="id-input-group">
              <text class="section-label">æ¯æ—¥ä»»åŠ¡ID</text>
              <input class="title-input" value="{{draft.dailyTaskId}}" bindinput="onDailyTaskIdInput" />
            </view>
            <view class="switch-group">
              <text class="switch-label">ä»»åŠ¡ç±»å‹</text>
              <view class="custom-switch">
                <text class="switch-option {{!draft.isPermanent ? 'active' : ''}}" bindtap="setRandom">éšæœº</text>
                <text class="switch-option {{draft.isPermanent ? 'active' : ''}}" bindtap="setPermanent">å¸¸é©»</text>
              </view>
            </view>
          </view>
        </view>

        <!-- æ¯å‘¨ä»»åŠ¡IDè¾“å…¥å’Œä»»åŠ¡ç±»å‹å¼€å…³ï¼ˆä»…æ¯å‘¨ä»»åŠ¡æ˜¾ç¤ºï¼‰ -->
        <view class="input-section" wx:if="{{activeTab==='weekly'}}">
          <view class="id-switch-row">
            <view class="id-input-group">
              <text class="section-label">æ¯å‘¨ä»»åŠ¡ID</text>
              <input class="title-input" value="{{draft.weeklyTaskId}}" bindinput="onWeeklyTaskIdInput" />
            </view>
            <view class="switch-group">
              <text class="switch-label">ä»»åŠ¡ç±»å‹</text>
              <view class="custom-switch">
                <text class="switch-option {{!draft.isPermanent ? 'active' : ''}}" bindtap="setRandom">éšæœº</text>
                <text class="switch-option {{draft.isPermanent ? 'active' : ''}}" bindtap="setPermanent">å¸¸é©»</text>
              </view>
            </view>
          </view>
        </view>

        <!-- æ´»åŠ¨ä»»åŠ¡IDè¾“å…¥ï¼ˆä»…æ´»åŠ¨ä»»åŠ¡æ˜¾ç¤ºï¼‰ -->
        <view class="input-section" wx:if="{{activeTab==='event'}}">
          <text class="section-label">æ´»åŠ¨ä»»åŠ¡ID</text>
          <input class="title-input" value="{{draft.activityId}}" bindinput="onActivityTaskIdInput" />
        </view>

        <!-- æ¯æ—¥ä»»åŠ¡ä¿¡æ¯å±•ç¤ºåŒºåŸŸï¼ˆä»…æ¯æ—¥ä»»åŠ¡æ˜¾ç¤ºï¼‰ -->
        <view class="daily-task-info" wx:if="{{activeTab==='daily' && draft.title}}">
          <!-- ä»»åŠ¡æ ‡é¢˜ -->
          <view class="info-section">
            <label class="info-label">ä»»åŠ¡æ ‡é¢˜ï¼š</label>
            <text class="info-value">{{draft.title}}</text>
          </view>

          <!-- é“œå¸å¥–åŠ± -->
          <view class="info-section" wx:if="{{draft.hasCoin}}">
            <label class="info-label">é“œå¸å¥–åŠ±ï¼š</label>
            <text class="info-value coin-value">{{draft.coin}} é“œå¸</text>
          </view>

          <!-- é’»çŸ³å¥–åŠ± -->
          <view class="info-section" wx:if="{{draft.hasDiamond}}">
            <label class="info-label">é’»çŸ³å¥–åŠ±ï¼š</label>
            <text class="info-value diamond-value">{{draft.diamond}} é’»çŸ³</text>
          </view>
        </view>

        <!-- æ¯å‘¨ä»»åŠ¡ä¿¡æ¯å±•ç¤ºåŒºåŸŸï¼ˆä»…æ¯å‘¨ä»»åŠ¡æ˜¾ç¤ºï¼‰ -->
        <view class="weekly-task-info" wx:if="{{activeTab==='weekly' && draft.title}}">
          <!-- ä»»åŠ¡æ ‡é¢˜ -->
          <view class="info-section">
            <label class="info-label">ä»»åŠ¡æ ‡é¢˜ï¼š</label>
            <text class="info-value">{{draft.title}}</text>
          </view>

          <!-- é“œå¸å¥–åŠ± -->
          <view class="info-section" wx:if="{{draft.hasCoin}}">
            <label class="info-label">é“œå¸å¥–åŠ±ï¼š</label>
            <text class="info-value coin-value">{{draft.coin}} é“œå¸</text>
          </view>

          <!-- é’»çŸ³å¥–åŠ± -->
          <view class="info-section" wx:if="{{draft.hasDiamond}}">
            <label class="info-label">é’»çŸ³å¥–åŠ±ï¼š</label>
            <text class="info-value diamond-value">{{draft.diamond}} é’»çŸ³</text>
          </view>
        </view>

        <!-- æ´»åŠ¨ä»»åŠ¡ä¿¡æ¯å±•ç¤ºåŒºåŸŸï¼ˆä»…æ´»åŠ¨ä»»åŠ¡æ˜¾ç¤ºï¼‰ -->
        <view class="activity-task-info" wx:if="{{activeTab==='event' && draft.title}}">
          <!-- ä»»åŠ¡æ ‡é¢˜ -->
          <view class="info-section">
            <label class="info-label">ä»»åŠ¡æ ‡é¢˜ï¼š</label>
            <text class="info-value">{{draft.title}}</text>
          </view>

          <!-- é“œå¸å¥–åŠ± -->
          <view class="info-section" wx:if="{{draft.hasCoin}}">
            <label class="info-label">é“œå¸å¥–åŠ±ï¼š</label>
            <text class="info-value coin-value">{{draft.coin}} é“œå¸</text>
          </view>

          <!-- é’»çŸ³å¥–åŠ± -->
          <view class="info-section" wx:if="{{draft.hasDiamond}}">
            <label class="info-label">é’»çŸ³å¥–åŠ±ï¼š</label>
            <text class="info-value diamond-value">{{draft.diamond}} é’»çŸ³</text>
          </view>
        </view>

        <!-- ä»»åŠ¡æ ‡é¢˜ï¼ˆæ¯æ—¥/æ¯å‘¨ä»»åŠ¡æ—¶æ‰‹åŠ¨è¾“å…¥ï¼Œä»…åœ¨æ²¡æœ‰åŒ¹é…åˆ°ä»»åŠ¡æ—¶æ˜¾ç¤ºï¼‰ -->
        <view class="input-section" wx:if="{{(activeTab==='daily' || activeTab==='weekly') && !draft.title}}">
          <text class="section-label">ä»»åŠ¡æ ‡é¢˜</text>
          <input class="title-input" value="{{draft.title}}" bindinput="onDraftTitle" />
        </view>
        
        <!-- ä»»åŠ¡æè¿° -->
        <view class="input-section">
          <text class="section-label">ä»»åŠ¡æè¿°</text>
          <textarea class="desc-textarea" value="{{draft.desc}}" bindinput="onDraftDesc"></textarea>
        </view>
        
        <!-- æ¯æ—¥/æ¯å‘¨ä»»åŠ¡è‡ªå®šä¹‰å¥–åŠ±ï¼ˆä½¿ç”¨å¼€å…³æ ·å¼ï¼‰ -->
        <view class="custom-reward-section" wx:if="{{activeTab==='daily' || activeTab==='weekly'}}">
          <view class="custom-reward-header">
            <label class="custom-reward-label">è‡ªå®šä¹‰å¥–åŠ±ï¼š</label>
            <switch 
              checked="{{draft.hasCustom}}" 
              bindchange="toggleCustomReward"
              color="#007aff"
            />
          </view>
          
          <view class="custom-reward-content" wx:if="{{draft.hasCustom}}">
            <textarea 
              class="custom-textarea" 
              value="{{draft.custom}}" 
              bindinput="onCustomInput"
            />
          </view>
        </view>
        
        <!-- æ´»åŠ¨ä»»åŠ¡è‡ªå®šä¹‰å¥–åŠ±ï¼ˆä½¿ç”¨å¼€å…³æ ·å¼ï¼‰ -->
        <view class="custom-reward-section" wx:if="{{activeTab==='event'}}">
          <view class="custom-reward-header">
            <label class="custom-reward-label">è‡ªå®šä¹‰å¥–åŠ±ï¼š</label>
            <switch 
              checked="{{draft.hasCustom}}" 
              bindchange="toggleCustomReward"
              color="#007aff"
            />
          </view>
          
          <view class="custom-reward-content" wx:if="{{draft.hasCustom}}">
            <textarea 
              class="custom-textarea" 
              value="{{draft.custom}}" 
              bindinput="onCustomInput"
            />
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¼–è¾‘ä»»åŠ¡é¢æ¿ -->
  <view class="publish-panel {{showEditPanel ? 'show' : ''}}" wx:if="{{showEditPanel}}" catchtouchmove>
    <view class="panel-content">
      <view class="panel-header">
        <text class="panel-title">ç¼–è¾‘ä»»åŠ¡</text>
        <view class="header-actions">
          <button class="cancel-btn" bindtap="hideEditPanel">å–æ¶ˆ</button>
          <button class="publish-btn" bindtap="updateTask">æ›´æ–°</button>
        </view>
      </view>
      
      <view class="input-group">
        <!-- ä»»åŠ¡æ ‡é¢˜ -->
        <view class="input-section">
          <text class="section-label">ä»»åŠ¡æ ‡é¢˜</text>
          <input class="title-input" value="{{editDraft.title}}" bindinput="onEditDraftTitle" />
        </view>
        
        <!-- ä»»åŠ¡æè¿° -->
        <view class="input-section">
          <text class="section-label">ä»»åŠ¡æè¿°</text>
          <textarea class="desc-textarea" value="{{editDraft.desc}}" bindinput="onEditDraftDesc"></textarea>
        </view>
        
        <!-- å¥–åŠ±è®¾ç½®æ ‡é¢˜ -->
        <view class="reward-title-row">
          <text class="reward-title">å¥–åŠ±è®¾ç½®</text>
        </view>
        
        <!-- é“œé’±è®¾ç½® -->
        <view class="reward-setting-row">
          <view class="check-box {{editDraft.hasCoin ? 'checked' : ''}}" data-type="coin" bindtap="toggleEditCoinReward"><text class="tick" wx:if="{{editDraft.hasCoin}}">âˆš</text></view>
          <image src="../../images/coin.png" class="reward-icon" />
          <input class="reward-number-input" type="number" value="{{editDraft.coin}}" data-type="coin" bindinput="onEditRewardInput" />
          <button class="reward-btn minus" data-type="coin" bindtap="decreaseEditReward">â–</button>
          <button class="reward-btn plus" data-type="coin" bindtap="increaseEditReward">â•</button>
        </view>
        
        <!-- é’»çŸ³è®¾ç½® -->
        <view class="reward-setting-row">
          <view class="check-box {{editDraft.hasDiamond ? 'checked' : ''}}" data-type="diamond" bindtap="toggleEditDiamondReward"><text class="tick" wx:if="{{editDraft.hasDiamond}}">âˆš</text></view>
          <image src="../../images/diamond.png" class="reward-icon" />
          <input class="reward-number-input" type="number" value="{{editDraft.diamond}}" data-type="diamond" bindinput="onEditRewardInput" />
          <button class="reward-btn minus" data-type="diamond" bindtap="decreaseEditReward">â–</button>
          <button class="reward-btn plus" data-type="diamond" bindtap="increaseEditReward">â•</button>
        </view>
        
        <!-- è‡ªå®šä¹‰è®¾ç½® -->
        <view class="reward-setting-row">
          <view class="check-box {{editDraft.hasCustom ? 'checked' : ''}}" data-type="custom" bindtap="toggleEditCustomReward"><text class="tick" wx:if="{{editDraft.hasCustom}}">âˆš</text></view>
          <text class="reward-label">è‡ªå®šä¹‰</text>
        </view>
        
        <!-- è‡ªå®šä¹‰è¾“å…¥æ¡† -->
        <view class="custom-input-section" wx:if="{{editDraft.hasCustom}}">
          <textarea class="custom-textarea" value="{{editDraft.custom}}" bindinput="onEditCustomInput"></textarea>
        </view>
      </view>
    </view>
  </view>

</view> 