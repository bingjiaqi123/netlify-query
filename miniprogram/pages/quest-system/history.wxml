<view class="history-container">
  <!-- 第一行：返回按钮和我是家长按钮 -->
  <view class="top-row">
    <button class="back-btn" bindtap="goBack">返回</button>
    <button class="parent-btn {{isParentMode ? 'active' : ''}}" bindtap="toggleMode">{{isParentMode ? '👨‍👩‍👧‍👦' : '我是家长'}}</button>
  </view>

  <!-- 标签页切换 -->
  <view class="tab-container">
    <view class="tab-item {{activeTab === 'task' ? 'active' : ''}}" data-tab="task" bindtap="switchTab">
      <text class="tab-text">任务</text>
    </view>
    <view class="tab-item {{activeTab === 'achieve' ? 'active' : ''}}" data-tab="achieve" bindtap="switchTab">
      <text class="tab-text">成就</text>
    </view>
  </view>

  <!-- 学生模式：显示学生记录 -->
  <view class="student-mode" wx:if="{{!isParentMode}}">
    <!-- 任务标签页 -->
    <view class="tab-content" wx:if="{{activeTab === 'task'}}">
      <block wx:for="{{studentTasks}}" wx:key="id">
        <view class="record student-record {{'type-' + (item.type || 'task')}}">
          <view class="record-header">
            <text class="task-id" wx:if="{{item.twoDigitId}}">[{{item.twoDigitId}}]</text>
            <text class="task-title">{{item.title}}</text>
            <text class="task-score">{{item.score}}分</text>
          </view>
          <view class="record-details">
            <view class="detail-row" wx:if="{{item.desc}}">
              <text class="label">描述：</text>
              <text class="value">{{item.desc}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.submitTimeText}}">
              <text class="label">提交时间：</text>
              <text class="value">{{item.submitTimeText}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.rewards}}">
              <text class="label">获得奖励：</text>
              <view class="value rewards">
                <view wx:if="{{item.rewards.coin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.rewards.coin}}</view>
                <view wx:if="{{item.rewards.diamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.rewards.diamond}}</view>
                <text wx:if="{{item.rewards.custom}}" class="reward custom">{{item.rewards.custom}}</text>
              </view>
            </view>
          </view>
        </view>
      </block>
      <view wx:if="{{!studentTasks || studentTasks.length === 0}}" class="empty">暂无完成任务</view>
    </view>

    <!-- 成就标签页 -->
    <view class="tab-content" wx:if="{{activeTab === 'achieve'}}">
      <block wx:for="{{studentAchievements}}" wx:key="id">
        <view class="record student-record type-achieve">
          <view class="record-header">
            <text class="task-id" wx:if="{{item.twoDigitId}}">[{{item.twoDigitId}}]</text>
            <text class="task-title">{{item.title}}</text>
            <text class="task-score">{{item.score}}分</text>
          </view>
          <view class="record-details">
            <view class="detail-row" wx:if="{{item.desc}}">
              <text class="label">描述：</text>
              <text class="value">{{item.desc}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.submitTimeText}}">
              <text class="label">提交时间：</text>
              <text class="value">{{item.submitTimeText}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.rewards}}">
              <text class="label">获得奖励：</text>
              <view class="value rewards">
                <view wx:if="{{item.rewards.coin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.rewards.coin}}</view>
                <view wx:if="{{item.rewards.diamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.rewards.diamond}}</view>
                <text wx:if="{{item.rewards.custom}}" class="reward custom">{{item.rewards.custom}}</text>
              </view>
            </view>
          </view>
        </view>
      </block>
      <view wx:if="{{!studentAchievements || studentAchievements.length === 0}}" class="empty">暂无完成成就</view>
    </view>
  </view>

  <!-- 家长模式：显示家长记录 -->
  <view class="parent-mode" wx:if="{{isParentMode}}">
    <!-- 任务标签页 -->
    <view class="tab-content" wx:if="{{activeTab === 'task'}}">
      <block wx:for="{{parentTasks}}" wx:key="id">
        <view class="record parent-record {{'type-' + (item.type || 'task')}}">
          <view class="record-header">
            <text class="task-id" wx:if="{{item.twoDigitId}}">[{{item.twoDigitId}}]</text>
            <text class="task-title">{{item.title}}</text>
            <text class="task-score">{{item.score}}分</text>
          </view>
          <view class="record-details">
            <view class="detail-row" wx:if="{{item.desc}}">
              <text class="label">描述：</text>
              <text class="value">{{item.desc}}</text>
            </view>
            <view class="detail-row">
              <text class="label">预设奖励：</text>
              <view class="value rewards">
                <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
                <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
                <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
              </view>
            </view>
            <view class="detail-row" wx:if="{{item.submitTimeText}}">
              <text class="label">提交时间：</text>
              <text class="value">{{item.submitTimeText}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.rewards}}">
              <text class="label">实际奖励：</text>
              <view class="value rewards">
                <view wx:if="{{item.rewards.coin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.rewards.coin}}</view>
                <view wx:if="{{item.rewards.diamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.rewards.diamond}}</view>
                <text wx:if="{{item.rewards.custom}}" class="reward custom">{{item.rewards.custom}}</text>
              </view>
            </view>
          </view>
        </view>
      </block>
      <view wx:if="{{!parentTasks || parentTasks.length === 0}}" class="empty">暂无完成任务</view>
    </view>

    <!-- 成就标签页 -->
    <view class="tab-content" wx:if="{{activeTab === 'achieve'}}">
      <block wx:for="{{parentAchievements}}" wx:key="id">
        <view class="record parent-record type-achieve">
          <view class="record-header">
            <text class="task-id" wx:if="{{item.twoDigitId}}">[{{item.twoDigitId}}]</text>
            <text class="task-title">{{item.title}}</text>
            <text class="task-score">{{item.score}}分</text>
          </view>
          <view class="record-details">
            <view class="detail-row" wx:if="{{item.desc}}">
              <text class="label">描述：</text>
              <text class="value">{{item.desc}}</text>
            </view>
            <view class="detail-row">
              <text class="label">预设奖励：</text>
              <view class="value rewards">
                <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
                <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
                <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
              </view>
            </view>
            <view class="detail-row" wx:if="{{item.submitTimeText}}">
              <text class="label">提交时间：</text>
              <text class="value">{{item.submitTimeText}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.rewards}}">
              <text class="label">实际奖励：</text>
              <view class="value rewards">
                <view wx:if="{{item.rewards.coin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.rewards.coin}}</view>
                <view wx:if="{{item.rewards.diamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.rewards.diamond}}</view>
                <text wx:if="{{item.rewards.custom}}" class="reward custom">{{item.rewards.custom}}</text>
              </view>
            </view>
          </view>
        </view>
      </block>
      <view wx:if="{{!parentAchievements || parentAchievements.length === 0}}" class="empty">暂无完成成就</view>
    </view>
  </view>
</view> 