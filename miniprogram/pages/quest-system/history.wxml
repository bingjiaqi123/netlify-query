<view class="history-container">
  <!-- ç¬¬ä¸€è¡Œï¼šè¿”å›æŒ‰é’®å’Œæˆ‘æ˜¯å®¶é•¿æŒ‰é’® -->
  <view class="top-row">
    <button class="back-btn" bindtap="goBack">è¿”å›</button>
    <button class="parent-btn {{isParentMode ? 'active' : ''}}" bindtap="toggleMode">{{isParentMode ? 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' : 'æˆ‘æ˜¯å®¶é•¿'}}</button>
  </view>

  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <view class="tab-container">
    <view class="tab-item {{activeTab === 'task' ? 'active' : ''}}" data-tab="task" bindtap="switchTab">
      <text class="tab-text">ä»»åŠ¡</text>
    </view>
    <view class="tab-item {{activeTab === 'achieve' ? 'active' : ''}}" data-tab="achieve" bindtap="switchTab">
      <text class="tab-text">æˆå°±</text>
    </view>
  </view>

  <!-- å­¦ç”Ÿæ¨¡å¼ï¼šæ˜¾ç¤ºå­¦ç”Ÿè®°å½• -->
  <view class="student-mode" wx:if="{{!isParentMode}}">
    <!-- ä»»åŠ¡æ ‡ç­¾é¡µ -->
    <view class="tab-content" wx:if="{{activeTab === 'task'}}">
      <block wx:for="{{studentTasks}}" wx:key="id">
        <view class="record student-record {{'type-' + (item.type || 'task')}}">
          <view class="record-header">
            <text class="task-id" wx:if="{{item.twoDigitId}}">[{{item.twoDigitId}}]</text>
            <text class="task-title">{{item.title}}</text>
            <text class="task-score">{{item.score}}åˆ†</text>
          </view>
          <view class="record-details">
            <view class="detail-row" wx:if="{{item.desc}}">
              <text class="label">æè¿°ï¼š</text>
              <text class="value">{{item.desc}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.submitTimeText}}">
              <text class="label">æäº¤æ—¶é—´ï¼š</text>
              <text class="value">{{item.submitTimeText}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.rewards}}">
              <text class="label">è·å¾—å¥–åŠ±ï¼š</text>
              <view class="value rewards">
                <view wx:if="{{item.rewards.coin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.rewards.coin}}</view>
                <view wx:if="{{item.rewards.diamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.rewards.diamond}}</view>
                <text wx:if="{{item.rewards.custom}}" class="reward custom">{{item.rewards.custom}}</text>
              </view>
            </view>
          </view>
        </view>
      </block>
      <view wx:if="{{!studentTasks || studentTasks.length === 0}}" class="empty">æš‚æ— å®Œæˆä»»åŠ¡</view>
    </view>

    <!-- æˆå°±æ ‡ç­¾é¡µ -->
    <view class="tab-content" wx:if="{{activeTab === 'achieve'}}">
      <block wx:for="{{studentAchievements}}" wx:key="id">
        <view class="record student-record type-achieve">
          <view class="record-header">
            <text class="task-id" wx:if="{{item.twoDigitId}}">[{{item.twoDigitId}}]</text>
            <text class="task-title">{{item.title}}</text>
            <text class="task-score">{{item.score}}åˆ†</text>
          </view>
          <view class="record-details">
            <view class="detail-row" wx:if="{{item.desc}}">
              <text class="label">æè¿°ï¼š</text>
              <text class="value">{{item.desc}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.submitTimeText}}">
              <text class="label">æäº¤æ—¶é—´ï¼š</text>
              <text class="value">{{item.submitTimeText}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.rewards}}">
              <text class="label">è·å¾—å¥–åŠ±ï¼š</text>
              <view class="value rewards">
                <view wx:if="{{item.rewards.coin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.rewards.coin}}</view>
                <view wx:if="{{item.rewards.diamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.rewards.diamond}}</view>
                <text wx:if="{{item.rewards.custom}}" class="reward custom">{{item.rewards.custom}}</text>
              </view>
            </view>
          </view>
        </view>
      </block>
      <view wx:if="{{!studentAchievements || studentAchievements.length === 0}}" class="empty">æš‚æ— å®Œæˆæˆå°±</view>
    </view>
  </view>

  <!-- å®¶é•¿æ¨¡å¼ï¼šæ˜¾ç¤ºå®¶é•¿è®°å½• -->
  <view class="parent-mode" wx:if="{{isParentMode}}">
    <!-- ä»»åŠ¡æ ‡ç­¾é¡µ -->
    <view class="tab-content" wx:if="{{activeTab === 'task'}}">
      <block wx:for="{{parentTasks}}" wx:key="id">
        <view class="record parent-record {{'type-' + (item.type || 'task')}}">
          <view class="record-header">
            <text class="task-id" wx:if="{{item.twoDigitId}}">[{{item.twoDigitId}}]</text>
            <text class="task-title">{{item.title}}</text>
            <text class="task-score">{{item.score}}åˆ†</text>
          </view>
          <view class="record-details">
            <view class="detail-row" wx:if="{{item.desc}}">
              <text class="label">æè¿°ï¼š</text>
              <text class="value">{{item.desc}}</text>
            </view>
            <view class="detail-row">
              <text class="label">é¢„è®¾å¥–åŠ±ï¼š</text>
              <view class="value rewards">
                <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
                <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
                <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
              </view>
            </view>
            <view class="detail-row" wx:if="{{item.submitTimeText}}">
              <text class="label">æäº¤æ—¶é—´ï¼š</text>
              <text class="value">{{item.submitTimeText}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.rewards}}">
              <text class="label">å®é™…å¥–åŠ±ï¼š</text>
              <view class="value rewards">
                <view wx:if="{{item.rewards.coin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.rewards.coin}}</view>
                <view wx:if="{{item.rewards.diamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.rewards.diamond}}</view>
                <text wx:if="{{item.rewards.custom}}" class="reward custom">{{item.rewards.custom}}</text>
              </view>
            </view>
          </view>
        </view>
      </block>
      <view wx:if="{{!parentTasks || parentTasks.length === 0}}" class="empty">æš‚æ— å®Œæˆä»»åŠ¡</view>
    </view>

    <!-- æˆå°±æ ‡ç­¾é¡µ -->
    <view class="tab-content" wx:if="{{activeTab === 'achieve'}}">
      <block wx:for="{{parentAchievements}}" wx:key="id">
        <view class="record parent-record type-achieve">
          <view class="record-header">
            <text class="task-id" wx:if="{{item.twoDigitId}}">[{{item.twoDigitId}}]</text>
            <text class="task-title">{{item.title}}</text>
            <text class="task-score">{{item.score}}åˆ†</text>
          </view>
          <view class="record-details">
            <view class="detail-row" wx:if="{{item.desc}}">
              <text class="label">æè¿°ï¼š</text>
              <text class="value">{{item.desc}}</text>
            </view>
            <view class="detail-row">
              <text class="label">é¢„è®¾å¥–åŠ±ï¼š</text>
              <view class="value rewards">
                <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
                <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
                <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
              </view>
            </view>
            <view class="detail-row" wx:if="{{item.submitTimeText}}">
              <text class="label">æäº¤æ—¶é—´ï¼š</text>
              <text class="value">{{item.submitTimeText}}</text>
            </view>
            <view class="detail-row" wx:if="{{item.rewards}}">
              <text class="label">å®é™…å¥–åŠ±ï¼š</text>
              <view class="value rewards">
                <view wx:if="{{item.rewards.coin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.rewards.coin}}</view>
                <view wx:if="{{item.rewards.diamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.rewards.diamond}}</view>
                <text wx:if="{{item.rewards.custom}}" class="reward custom">{{item.rewards.custom}}</text>
              </view>
            </view>
          </view>
        </view>
      </block>
      <view wx:if="{{!parentAchievements || parentAchievements.length === 0}}" class="empty">æš‚æ— å®Œæˆæˆå°±</view>
    </view>
  </view>
</view> 