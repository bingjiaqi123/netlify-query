<view class="achievement-container">
  <!-- ç¬¬ä¸€è¡Œï¼šè¿”å›æŒ‰é’®å’Œæˆ‘æ˜¯å®¶é•¿æŒ‰é’® -->
  <view class="top-row">
    <button class="back-btn" bindtap="goBack">è¿”å›</button>
    <button class="parent-btn {{isParentMode ? 'active' : ''}}" bindtap="toggleMode">{{isParentMode ? 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' : 'æˆ‘æ˜¯å®¶é•¿'}}</button>
  </view>

  <!-- å­¦ç”Ÿæ¨¡å¼ï¼šæ˜¾ç¤ºæˆå°±åˆ—è¡¨ -->
  <view class="student-mode" wx:if="{{!isParentMode}}">
    <!-- ç¬¬äºŒè¡Œï¼šä¸¤ä¸ªæ ‡ç­¾é¡µ -->
    <view class="tabs">
      <text class="tab {{activeSub==='available'?'active':''}}" data-sub="available" bindtap="switchSub">æœªè¾¾æˆ</text>
      <text class="tab {{activeSub==='ongoing'?'active':''}}" data-sub="ongoing" bindtap="switchSub">å·²è¾¾æˆ</text>
    </view>

    <!-- æˆå°±åˆ—è¡¨ -->
    <view class="list">
      <block wx:for="{{visibleTasks}}" wx:key="id">
        <view class="task {{item.status==='pending-review'?'pending':''}}">
          <view class="task-content">
            <text class="title">{{item.achievementId ? ('[' + item.achievementId + '] ') : ''}}{{item.title}}</text>
            <view class="desc-container">
              <text class="desc">{{item.desc}}</text>
            </view>
            <view class="rewards">
              <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
              <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
              <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
            </view>
            <text wx:if="{{activeSub==='ongoing' && item.submitTimeText}}" class="task-time">æäº¤æ—¶é—´ï¼š{{item.submitTimeText}}</text>
          </view>
          <view class="task-actions">
            <block wx:if="{{activeSub==='available'}}">
              <button class="submit" data-id="{{item.id}}" bindtap="submitTask">æäº¤</button>
            </block>
            <block wx:elif="{{activeSub==='ongoing'}}">
              <block wx:if="{{item.status==='pending-review'}}">
                <text class="waiting">æ­£åœ¨ç­‰å¾…å®¡æ ¸â€¦</text>
              </block>
            </block>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- å®¶é•¿æ¨¡å¼ï¼šæ˜¾ç¤ºæˆå°±ç®¡ç† -->
  <view class="parent-mode" wx:if="{{isParentMode}}">
    <!-- å‘å¸ƒæˆå°±æŒ‰é’®å’Œç®¡ç†ç°æœ‰æˆå°±æ ‡é¢˜ -->
    <view class="top-section">
      <view class="section-title">ç®¡ç†ç°æœ‰æˆå°±</view>
      <button class="publish-achievement-btn" bindtap="showPublishPanel"><text class="btn-text">å‘å¸ƒæˆå°±</text></button>
    </view>

    <!-- æˆå°±ï¼šåˆ†æˆä¸¤éƒ¨åˆ†æ˜¾ç¤º -->
    <view>
      <!-- å·²æäº¤å¾…å®¡æ ¸çš„æˆå°± -->
      <view class="section-title">å·²æäº¤å¾…å®¡æ ¸</view>
      <view class="task-list">
        <block wx:for="{{pendingReviewTasks}}" wx:key="id">
          <view class="manage-task-card">
            <view class="task-content">
              <view class="task-header">
                <text class="task-title">{{item.achievementId ? ('[' + item.achievementId + '] ') : ''}}{{item.title}}</text>
              </view>
              <view class="task-desc">{{item.desc}}</view>
              <view class="task-meta">
                <view class="task-rewards">
                  <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
                  <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
                  <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
                </view>
              </view>
              <view class="task-time-row" wx:if="{{item.submitTimeText}}">
                <text class="task-time">{{item.submitTimeText ? 'æäº¤æ—¶é—´ï¼š' + item.submitTimeText : ''}}</text>
              </view>
            </view>
            <view class="task-actions">
              <view class="review-row">
                <button class="approve-round" data-id="{{item.id}}" bindtap="approveTask">ğŸ‘</button>
              </view>
              <view class="review-row">
                <input class="score-input" type="number" placeholder="100" data-id="{{item.id}}" bindinput="onScoreInput"/>
              </view>
            </view>
          </view>
        </block>
        <view wx:if="{{!pendingReviewTasks || pendingReviewTasks.length === 0}}" class="empty-tip">æš‚æ— å¾…å®¡æ ¸æˆå°±</view>
      </view>

      <!-- æœªæäº¤çš„æˆå°± -->
      <view class="section-title">æœªæäº¤æˆå°±</view>
      <view class="task-list">
        <block wx:for="{{availableTasks}}" wx:key="id">
          <view class="manage-task-card">
            <view class="task-content">
              <view class="task-header">
                <text class="task-title">{{item.achievementId ? ('[' + item.achievementId + '] ') : ''}}{{item.title}}</text>
              </view>
              <view class="task-desc">{{item.desc}}</view>
              <view class="task-meta">
                <view class="task-rewards">
                  <view wx:if="{{item.hasCoin}}" class="reward coin"><image src="../../images/coin.png" class="reward-icon" />{{item.coin}}</view>
                  <view wx:if="{{item.hasDiamond}}" class="reward diamond"><image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}</view>
                  <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
                </view>
              </view>
              <view class="task-time-row" wx:if="{{item.publishTimeText}}">
                <text class="task-time">{{'å‘å¸ƒæ—¶é—´ï¼š' + item.publishTimeText}}</text>
              </view>
            </view>
            <view class="task-actions">
              <button class="delete-btn" data-id="{{item.id}}" bindtap="deleteTask">ğŸ—‘ï¸</button>
            </view>
          </view>
        </block>
        <view wx:if="{{!availableTasks || availableTasks.length === 0}}" class="empty-tip">æš‚æ— æœªæäº¤æˆå°±</view>
      </view>
    </view>
  </view>

  <!-- å‘å¸ƒæˆå°±é¢æ¿ -->
  <view class="publish-panel" wx:if="{{showPublishPanel}}" catchtap="hidePublishPanel">
    <view class="publish-content" catchtap="stopPropagation">
      <view class="publish-header">
        <text class="publish-title">å‘å¸ƒæˆå°±</text>
        <text class="close-btn" bindtap="hidePublishPanel">Ã—</text>
      </view>
      
      <view class="publish-body">
        <!-- æˆå°±IDè¾“å…¥ -->
        <view class="input-group">
          <label class="input-label">æˆå°±IDï¼š</label>
          <input 
            class="title-input" 
            value="{{draft.achievementId}}"
            bindinput="onAchievementIdInput"
          />
        </view>

        <!-- æˆå°±ä¿¡æ¯å±•ç¤ºåŒºåŸŸ -->
        <view class="achievement-info" wx:if="{{draft.title}}">
          <!-- æˆå°±æ ‡é¢˜ -->
          <view class="info-section">
            <label class="info-label">æˆå°±æ ‡é¢˜ï¼š</label>
            <text class="info-value">{{draft.title}}</text>
          </view>

          <!-- é“œå¸å¥–åŠ± -->
          <view class="info-section" wx:if="{{draft.hasCoin}}">
            <label class="info-label">é“œå¸å¥–åŠ±ï¼š</label>
            <text class="info-value coin-value">{{draft.coin}} é“œå¸</text>
          </view>

          <!-- é’»çŸ³å¥–åŠ± -->
          <view class="info-section" wx:if="{{draft.hasDiamond}}">
            <label class="info-label">é’»çŸ³å¥–åŠ±ï¼š</label>
            <text class="info-value diamond-value">{{draft.diamond}} é’»çŸ³</text>
          </view>
        </view>

        <!-- æˆå°±æè¿° -->
        <view class="input-group">
          <label class="input-label">æˆå°±æè¿°ï¼š</label>
          <textarea 
            class="desc-input" 
            value="{{draft.desc}}"
            bindinput="onDraftDesc"
          />
        </view>

        <!-- è‡ªå®šä¹‰å¥–åŠ± -->
        <view class="custom-reward-section">
          <view class="custom-reward-header">
            <label class="custom-reward-label">è‡ªå®šä¹‰å¥–åŠ±ï¼š</label>
            <switch 
              checked="{{draft.hasCustom}}" 
              bindchange="toggleCustomReward"
              color="#007aff"
            />
          </view>
          
          <view class="custom-reward-content" wx:if="{{draft.hasCustom}}">
            <textarea 
              class="custom-input" 
              placeholder="è¯·è¾“å…¥è‡ªå®šä¹‰å¥–åŠ±å†…å®¹" 
              value="{{draft.custom}}"
              bindinput="onCustomInput"
            />
          </view>
        </view>
      </view>
      
      <view class="publish-footer">
        <button class="cancel-btn" bindtap="hidePublishPanel">å–æ¶ˆ</button>
        <button class="publish-btn" bindtap="publishTask" disabled="{{!draft.title}}">å‘å¸ƒ</button>
      </view>
    </view>
  </view>



</view> 