<!-- å›ºå®šåœ¨é¡¶éƒ¨çš„æ·»åŠ ç»„åŒºåŸŸ -->
<view class="fixed-add-group-section">
  <view class="add-group-row">
    <input class="group-id-input" value="{{newGroupId}}" bindinput="onNewGroupIdInput" />
    <input class="group-name-input" value="{{newGroupName}}" bindinput="onNewGroupNameInput" disabled="{{matchedGroup}}" />
    <button class="add-group-btn" bindtap="addToGroup">æ·»åŠ åˆ°ç»„</button>
  </view>
</view>

<view class="container">
  <!-- é¡µé¢æ ‡é¢˜è¡Œ -->
  <view class="title-row">
    <button class="back-btn" bindtap="goBack">è¿”å›</button>
    <text class="page-title">æ¯å‘¨éšæœºä»»åŠ¡æ± </text>
  </view>

  <!-- ä»»åŠ¡ç»„åˆ—è¡¨ -->
  <view class="group-list">
    <block wx:for="{{randomGroups}}" wx:key="name">
      <view class="group-block {{item.isPreset ? 'preset' : ''}}">
        <!-- ç¬¬ä¸€è¡Œï¼šç»„IDå’Œç»„å -->
        <view class="group-header">
          <view class="group-id-name-row">
            <text class="group-id">{{item.id}}</text>
            <text class="group-name">{{item.name}}</text>
            <view class="group-actions" wx:if="{{!item.isPreset}}">
              <button class="delete-group-btn" data-name="{{item.name}}" bindtap="deleteGroup">ğŸ—‘ï¸</button>
            </view>
          </view>
        </view>
        
        <!-- ç¬¬äºŒè¡Œï¼šæŠ½å–æ•°é‡å’Œæè¿° -->
        <view class="group-info-row">
          <view class="draw-count" wx:if="{{!item.isPreset}}">
            <text>æŠ½å–</text>
            <input class="draw-input" type="number" placeholder="0" value="{{item.drawCount}}" data-name="{{item.name}}" bindinput="onDrawCountInput" />
          </view>
          <text class="group-description" wx:if="{{item.description}}">{{item.description}}</text>
        </view>
        
        <!-- ç¬¬ä¸‰è¡Œèµ·ï¼šä»»åŠ¡åˆ—è¡¨ -->
        <view class="task-list">
          <block wx:for="{{item.tasks}}" wx:key="id" wx:for-item="item2">
            <view class="task-card {{item2.isPresetTask ? 'preset' : ''}}">
              <view class="task-content">
                <view class="task-header-row">
                  <checkbox wx:if="{{!item.isPreset && !item2.isPresetTask}}" checked="{{item.selected && item.selected[item2.id]}}" data-group="{{item.name}}" data-id="{{item2.id}}" bindtap="toggleSelectTask" />
                  <text class="task-title">{{item2.displayId ? ('[' + item2.displayId + '] ') : ''}}{{item2.title}}</text>
                  <view class="task-actions" wx:if="{{!item.isPreset && !item2.isPresetTask}}">
                    <button class="edit-btn" data-id="{{item2.id}}" data-group="{{item.name}}" bindtap="editTask">ğŸ–Šï¸</button>
                    <button class="delete-btn" data-id="{{item2.id}}" data-group="{{item.name}}" bindtap="deleteTask">ğŸ—‘ï¸</button>
                  </view>
                </view>
                <text class="task-desc">{{item2.desc}}</text>
                <view class="task-rewards">
                  <view wx:if="{{item2.hasCoin}}" class="reward coin">
                    <image src="../../images/coin.png" class="reward-icon" />{{item2.coin}}
                  </view>
                  <view wx:if="{{item2.hasDiamond}}" class="reward diamond">
                    <image src="../../images/diamond.png" class="reward-icon" />{{item2.diamond}}
                  </view>
                  <text wx:if="{{item2.hasCustom}}" class="reward custom">{{item2.custom}}</text>
                </view>
              </view>
            </view>
          </block>
        </view>
      </view>
    </block>
  </view>



</view>

<!-- ç¼–è¾‘ä»»åŠ¡é¢æ¿ -->
<view class="publish-panel {{showEditPanel ? 'show' : ''}}" wx:if="{{showEditPanel}}" catchtouchmove>
  <view class="panel-content">
    <view class="panel-header">
      <text class="panel-title">ç¼–è¾‘ä»»åŠ¡</text>
      <view class="header-actions">
        <button class="cancel-btn" bindtap="hideEditPanel">å–æ¶ˆ</button>
        <button class="publish-btn" bindtap="updateTask">æ›´æ–°</button>
      </view>
    </view>

    <view class="input-group">
      <!-- ä»»åŠ¡æ ‡é¢˜ -->
      <view class="input-section">
        <text class="section-label">ä»»åŠ¡æ ‡é¢˜</text>
        <input class="title-input" placeholder="è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰" value="{{draft.title}}" bindinput="onDraftTitle" />
      </view>

      <!-- ä»»åŠ¡æè¿° -->
      <view class="input-section">
        <text class="section-label">ä»»åŠ¡æè¿°</text>
        <textarea class="desc-textarea" placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°" value="{{draft.desc}}" bindinput="onDraftDesc"></textarea>
      </view>

      <!-- å¥–åŠ±è®¾ç½®æ ‡é¢˜ -->
      <view class="reward-title-row">
        <text class="reward-title">å¥–åŠ±è®¾ç½®</text>
      </view>

      <!-- é“œé’±è®¾ç½® -->
      <view class="reward-setting-row">
        <view class="check-box {{draft.hasCoin ? 'checked' : ''}}" data-type="coin" bindtap="toggleCoinReward"><text class="tick" wx:if="{{draft.hasCoin}}">âˆš</text></view>
        <image src="../../images/coin.png" class="reward-icon" />
        <input class="reward-number-input" type="number" placeholder="100" value="{{draft.coin}}" data-type="coin" bindinput="onRewardInput" />
        <button class="reward-btn minus" data-type="coin" bindtap="decreaseReward">â–</button>
        <button class="reward-btn plus" data-type="coin" bindtap="increaseReward">â•</button>
      </view>

      <!-- é’»çŸ³è®¾ç½® -->
      <view class="reward-setting-row">
        <view class="check-box {{draft.hasDiamond ? 'checked' : ''}}" data-type="diamond" bindtap="toggleDiamondReward"><text class="tick" wx:if="{{draft.hasDiamond}}">âˆš</text></view>
        <image src="../../images/diamond.png" class="reward-icon" />
        <input class="reward-number-input" type="number" placeholder="10" value="{{draft.diamond}}" data-type="diamond" bindinput="onRewardInput" />
        <button class="reward-btn minus" data-type="diamond" bindtap="decreaseReward">â–</button>
        <button class="reward-btn plus" data-type="diamond" bindtap="increaseReward">â•</button>
      </view>

      <!-- è‡ªå®šä¹‰è®¾ç½® -->
      <view class="reward-setting-row">
        <view class="check-box {{draft.hasCustom ? 'checked' : ''}}" data-type="custom" bindtap="toggleCustomReward"><text class="tick" wx:if="{{draft.hasCustom}}">âˆš</text></view>
        <text class="reward-label">è‡ªå®šä¹‰</text>
      </view>

      <!-- è‡ªå®šä¹‰è¾“å…¥æ¡† -->
      <view class="custom-input-section" wx:if="{{draft.hasCustom}}">
        <textarea class="custom-textarea" placeholder="è¯·è¾“å…¥è‡ªå®šä¹‰å¥–åŠ±" value="{{draft.custom}}" bindinput="onCustomInput"></textarea>
      </view>
    </view>
  </view>
</view>