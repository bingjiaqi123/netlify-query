<view class="container">
  <!-- é¡¶éƒ¨è¿”å›æŒ‰é’® -->
  <view class="top-header">
    <button class="back-btn" bindtap="goBack">è¿”å›</button>
  </view>

  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-title">æ¯æ—¥å¸¸é©»ä»»åŠ¡æ± </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <view class="task-list">
    <block wx:for="{{permanentTasks}}" wx:key="id">
      <view class="task-card {{item.isPreset ? 'preset' : ''}}">
        <view class="task-content">
          <view class="task-header-row">
            <text class="task-title">{{item.displayId ? ('[' + item.displayId + '] ') : ''}}{{item.title}}</text>
            <view class="task-actions" wx:if="{{!item.isPreset}}">
              <button class="edit-btn" data-id="{{item.id}}" bindtap="editTask">ğŸ–Šï¸</button>
              <button class="delete-btn" data-id="{{item.id}}" bindtap="deleteTask">ğŸ—‘ï¸</button>
            </view>
          </view>
          <text class="task-desc">{{item.desc}}</text>
          <view class="task-rewards">
            <view wx:if="{{item.hasCoin}}" class="reward coin">
              <image src="../../images/coin.png" class="reward-icon" />{{item.coin}}
            </view>
            <view wx:if="{{item.hasDiamond}}" class="reward diamond">
              <image src="../../images/diamond.png" class="reward-icon" />{{item.diamond}}
            </view>
            <text wx:if="{{item.hasCustom}}" class="reward custom">{{item.custom}}</text>
          </view>
        </view>
      </view>
    </block>
    <view wx:if="{{!permanentTasks || permanentTasks.length === 0}}" class="empty-tip">æš‚æ— ä»»åŠ¡</view>
  </view>

  <!-- ç¼–è¾‘ä»»åŠ¡é¢æ¿ -->
  <view class="publish-panel {{showEditPanel ? 'show' : ''}}" wx:if="{{showEditPanel}}" catchtouchmove>
    <view class="panel-content">
      <view class="panel-header">
        <text class="panel-title">ç¼–è¾‘ä»»åŠ¡</text>
        <view class="header-actions">
          <button class="cancel-btn" bindtap="hideEditPanel">å–æ¶ˆ</button>
          <button class="publish-btn" bindtap="updateTask">æ›´æ–°</button>
        </view>
      </view>
      
      <view class="input-group">
        <!-- ä»»åŠ¡æ ‡é¢˜ -->
        <view class="input-section">
          <text class="section-label">ä»»åŠ¡æ ‡é¢˜</text>
          <input class="title-input" placeholder="è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰" value="{{draft.title}}" bindinput="onDraftTitle" />
        </view>
        
        <!-- ä»»åŠ¡æè¿° -->
        <view class="input-section">
          <text class="section-label">ä»»åŠ¡æè¿°</text>
          <textarea class="desc-textarea" placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°" value="{{draft.desc}}" bindinput="onDraftDesc"></textarea>
        </view>
        
        <!-- å¥–åŠ±è®¾ç½®æ ‡é¢˜ -->
        <view class="reward-title-row">
          <text class="reward-title">å¥–åŠ±è®¾ç½®</text>
        </view>
        
        <!-- é“œé’±è®¾ç½® -->
        <view class="reward-setting-row">
          <view class="check-box {{draft.hasCoin ? 'checked' : ''}}" data-type="coin" bindtap="toggleCoinReward"><text class="tick" wx:if="{{draft.hasCoin}}">âˆš</text></view>
          <image src="../../images/coin.png" class="reward-icon" />
          <input class="reward-number-input" type="number" placeholder="100" value="{{draft.coin}}" data-type="coin" bindinput="onRewardInput" />
          <button class="reward-btn minus" data-type="coin" bindtap="decreaseReward">â–</button>
          <button class="reward-btn plus" data-type="coin" bindtap="increaseReward">â•</button>
        </view>
        
        <!-- é’»çŸ³è®¾ç½® -->
        <view class="reward-setting-row">
          <view class="check-box {{draft.hasDiamond ? 'checked' : ''}}" data-type="diamond" bindtap="toggleDiamondReward"><text class="tick" wx:if="{{draft.hasDiamond}}">âˆš</text></view>
          <image src="../../images/diamond.png" class="reward-icon" />
          <input class="reward-number-input" type="number" placeholder="10" value="{{draft.diamond}}" data-type="diamond" bindinput="onRewardInput" />
          <button class="reward-btn minus" data-type="diamond" bindtap="decreaseReward">â–</button>
          <button class="reward-btn plus" data-type="diamond" bindtap="increaseReward">â•</button>
        </view>
        
        <!-- è‡ªå®šä¹‰è®¾ç½® -->
        <view class="reward-setting-row">
          <view class="check-box {{draft.hasCustom ? 'checked' : ''}}" data-type="custom" bindtap="toggleCustomReward"><text class="tick" wx:if="{{draft.hasCustom}}">âˆš</text></view>
          <text class="reward-label">è‡ªå®šä¹‰</text>
        </view>
        
        <!-- è‡ªå®šä¹‰è¾“å…¥æ¡† -->
        <view class="custom-input-section" wx:if="{{draft.hasCustom}}">
          <textarea class="custom-textarea" placeholder="è¯·è¾“å…¥è‡ªå®šä¹‰å¥–åŠ±" value="{{draft.custom}}" bindinput="onCustomInput"></textarea>
        </view>
      </view>
    </view>
  </view>

</view> 