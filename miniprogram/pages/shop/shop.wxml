<view class="shop-container">
  <view class="shop-header">
    <text class="shop-title">å•†åº—</text>
    <text class="gold-display">ğŸ¥® {{gold}}</text>
  </view>

  <!-- é¡¶éƒ¨çŠ¶æ€ä¸æŒ‰é’®ï¼Œä¸æ¸¸æˆç•Œé¢ä¸€è‡´çš„æŒ‰é’® -->
  <view class="status-row2">
    <button class="control-btn info-btn" bindtap="showInfo">ç‰Œå‹</button>
    <button class="control-btn bag-btn" bindtap="openBag">èƒŒåŒ…</button>
    <button class="control-btn deck-btn" bindtap="showDeck">{{remainCards}}/{{totalCards}}</button>
  </view>

  <!-- ä¸‹ä¸€å›åˆæŒ‰é’®ï¼ˆä»…å•†åº—é¡µä¿ç•™ï¼‰ -->
  <view class="shop-next-row">
    <button class="next-round-btn" bindtap="nextRoundFromShop">ä¸‹ä¸€å›åˆ</button>
  </view>

  <!-- å°ä¸‘ç‰Œæ§½ä½ï¼ˆä½¿ç”¨ä¸æ¸¸æˆé¡µé¢ç›¸åŒçš„ç»„ä»¶å’Œæ•°æ®ï¼‰ -->
  <joker-strip jokers="{{jokerCards}}" maxSlots="7" tapEnabled="{{false}}" alignMode="left" />

  <!-- å•†åº—çŠ¶æ€ä¿¡æ¯ -->
  <view class="shop-status" wx:if="{{shopStatus.totalJokers > 0}}">
    <text class="status-text">å°ä¸‘ç‰Œæ”¶é›†è¿›åº¦: {{shopStatus.ownedJokers}}/{{shopStatus.totalJokers}}</text>
    <text class="status-text" wx:if="{{shopStatus.availableJokers === 0}}">ğŸ‰ å·²é›†é½æ‰€æœ‰å°ä¸‘ç‰Œï¼</text>
  </view>

  <!-- æ˜Ÿçƒç‰Œå•†å“åŒºï¼šä¸¤å¼ éšæœºæ˜Ÿçƒç‰Œï¼Œæ¯å¼ 3é‡‘å¸ -->
  <view class="planet-offers">
    <block wx:for="{{planetOffers}}" wx:key="index">
      <view class="planet-card {{item.sold ? 'sold' : ''}}" data-index="{{index}}" bindtap="buyPlanet">
        <view class="planet-inner">
          <view class="segment name-segment">
            <text class="planet-type">{{item.type}}</text>
          </view>
          <view class="segment level-segment">
            <text class="planet-level">{{item.level}}</text>
          </view>
          <view class="segment price-segment">
            <text class="price gold-text">ğŸ¥®3</text>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- å°ä¸‘ç‰Œå•†å“åŒºï¼šæ ¹æ®åº“å­˜æƒ…å†µæ˜¾ç¤º -->
  <view class="joker-offers" wx:if="{{shopStatus.shouldShowShop && jokerOffers.length > 0}}">
    <block wx:for="{{jokerOffers}}" wx:key="index">
      <view class="joker-offer-card {{item.sold ? 'sold' : ''}}" data-index="{{index}}" bindtap="buyJoker">
        <view class="joker-card-header" style="background-color: {{item.backgroundColor}};">
          <view class="joker-name-row">
            <text class="joker-name" style="color: {{item.textColor}};">{{item.name}}</text>
            <text class="joker-category" style="color: {{item.textColor}};">{{item.category}}</text>
            <text class="joker-price" style="color: {{item.textColor}};">ğŸ¥®{{item.buyPrice}}</text>
          </view>
        </view>
        <view class="joker-card-body">
          <text class="joker-effect">{{item.effect}}</text>
        </view>
      </view>
    </block>
  </view>

  <!-- æ— å°ä¸‘ç‰Œå¯è´­ä¹°æ—¶çš„æç¤º -->
  <view class="no-jokers-tip" wx:if="{{!shopStatus.shouldShowShop || jokerOffers.length === 0}}">
    <text class="tip-text">ğŸ‰ æ­å–œï¼å·²é›†é½æ‰€æœ‰å°ä¸‘ç‰Œ</text>
    <text class="tip-text">å•†åº—æš‚æ—¶æ²¡æœ‰æ–°çš„å°ä¸‘ç‰Œå¯è´­ä¹°</text>
  </view>

  <!-- èƒŒåŒ…é¢æ¿ -->
  <view class="bag-overlay" wx:if="{{showBagPanel}}">
    <view class="bag-panel">
      <view class="bag-header">
        <text class="bag-title">èƒŒåŒ… - æ˜Ÿçƒç‰Œ</text>
        <button class="close-btn" bindtap="closeBag">Ã—</button>
      </view>
      <view class="bag-toolbar-row1">
        <button class="toggle-select-btn" bindtap="toggleSelectAll">{{isAllSelected ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}</button>
      </view>
      <view class="bag-toolbar-row2">
        <button class="use-btn" wx:if="{{selectedCount>0}}" bindtap="useSelectedPlanet">ä½¿ç”¨</button>
        <button class="sell-btn" wx:if="{{selectedCount>0}}" bindtap="sellSelectedPlanet">å”®å‡º(<text class="gold-text">ğŸ¥®{{selectedCount}}</text>)</button>
      </view>
      <view class="bag-grid">
        <block wx:for="{{bagItems}}" wx:key="id">
          <view class="bag-planet{{item.__selected?' selected':''}}" data-index="{{index}}" bindtap="toggleSelectOne">
            <view class="planet-inner small">
              <text class="planet-type">{{item.type}}</text>
              <text class="planet-level">{{item.level || 1}}</text>
            </view>
          </view>
        </block>
        <view wx:if="{{!bagItems || bagItems.length === 0}}" class="empty-tip">æš‚æ— æ˜Ÿçƒç‰Œ</view>
      </view>
    </view>
  </view>
</view>

<!-- æ¯”èµ›ä¿¡æ¯è¦†ç›–å±‚ï¼ˆä¸æ¸¸æˆç•Œé¢ä¸€è‡´ï¼‰ -->
<view class="info-overlay" wx:if="{{showInfoPanel}}">
  <view class="info-panel">
    <view class="info-header">
      <button class="tab-btn{{infoActiveTab==='types' ? ' active' : ''}}" data-tab="types" bindtap="switchInfoTab">ç‰Œå‹</button>
      <button class="tab-btn{{infoActiveTab==='coupons' ? ' active' : ''}}" data-tab="coupons" bindtap="switchInfoTab">ä¼˜æƒ åˆ¸</button>
      <button class="close-btn" bindtap="closeInfo">Ã—</button>
    </view>
    <view class="info-body" wx:if="{{infoActiveTab==='types'}}">
      <view class="info-table">
        <block wx:for="{{infoTypeRows}}" wx:key="type">
          <view class="info-row">
            <text class="col-level">{{item.level}}</text>
            <text class="col-type">{{item.type}}</text>
            <view class="col-product">
              <text class="chip-label">{{item.chip}}</text>
              <text class="multiply-x">âœ–ï¸</text>
              <text class="multiplier-label">{{item.multiplier}}</text>
            </view>
            <text class="col-count"><text class="count-hash">#</text><text class="count-orange">{{item.playCount}}</text></text>
          </view>
        </block>
      </view>
    </view>
    <view class="info-body" wx:elif="{{infoActiveTab==='coupons'}}">
      <view class="empty-tip">æš‚æ— ä¼˜æƒ åˆ¸</view>
    </view>
  </view>
</view>

<!-- æ¨¡ä»¿è€…é€‰æ‹©å™¨ -->
<joker-mimic-selector 
  visible="{{showMimicSelector}}" 
  availableJokers="{{availableJokersForMimic}}"
  bind:jokerSelected="onMimicJokerSelected"
  bind:cancel="onMimicSelectionCanceled"
/> 