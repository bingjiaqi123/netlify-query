<view class="shop-container">
  <view class="shop-header">
    <text class="shop-title">商店</text>
    <text class="gold-display">🥮 {{gold}}</text>
  </view>

  <!-- 顶部状态与按钮，与游戏界面一致的按钮 -->
  <view class="status-row2">
    <button class="control-btn info-btn" bindtap="showInfo">牌型</button>
    <button class="control-btn bag-btn" bindtap="openBag">背包</button>
    <button class="control-btn deck-btn" bindtap="showDeck">{{remainCards}}/{{totalCards}}</button>
  </view>

  <!-- 下一回合按钮（仅商店页保留） -->
  <view class="shop-next-row">
    <button class="next-round-btn" bindtap="nextRoundFromShop">下一回合</button>
  </view>

  <!-- 小丑牌槽位（使用与游戏页面相同的组件和数据） -->
  <joker-strip jokers="{{jokerCards}}" maxSlots="7" tapEnabled="{{false}}" alignMode="left" />

  <!-- 商店状态信息 -->
  <view class="shop-status" wx:if="{{shopStatus.totalJokers > 0}}">
    <text class="status-text">小丑牌收集进度: {{shopStatus.ownedJokers}}/{{shopStatus.totalJokers}}</text>
    <text class="status-text" wx:if="{{shopStatus.availableJokers === 0}}">🎉 已集齐所有小丑牌！</text>
  </view>

  <!-- 星球牌商品区：两张随机星球牌，每张3金币 -->
  <view class="planet-offers">
    <block wx:for="{{planetOffers}}" wx:key="index">
      <view class="planet-card {{item.sold ? 'sold' : ''}}" data-index="{{index}}" bindtap="buyPlanet">
        <view class="planet-inner">
          <view class="segment name-segment">
            <text class="planet-type">{{item.type}}</text>
          </view>
          <view class="segment level-segment">
            <text class="planet-level">{{item.level}}</text>
          </view>
          <view class="segment price-segment">
            <text class="price gold-text">🥮3</text>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- 小丑牌商品区：根据库存情况显示 -->
  <view class="joker-offers" wx:if="{{shopStatus.shouldShowShop && jokerOffers.length > 0}}">
    <block wx:for="{{jokerOffers}}" wx:key="index">
      <view class="joker-offer-card {{item.sold ? 'sold' : ''}}" data-index="{{index}}" bindtap="buyJoker">
        <view class="joker-card-header" style="background-color: {{item.backgroundColor}};">
          <view class="joker-name-row">
            <text class="joker-name" style="color: {{item.textColor}};">{{item.name}}</text>
            <text class="joker-category" style="color: {{item.textColor}};">{{item.category}}</text>
            <text class="joker-price" style="color: {{item.textColor}};">🥮{{item.buyPrice}}</text>
          </view>
        </view>
        <view class="joker-card-body">
          <text class="joker-effect">{{item.effect}}</text>
        </view>
      </view>
    </block>
  </view>

  <!-- 无小丑牌可购买时的提示 -->
  <view class="no-jokers-tip" wx:if="{{!shopStatus.shouldShowShop || jokerOffers.length === 0}}">
    <text class="tip-text">🎉 恭喜！已集齐所有小丑牌</text>
    <text class="tip-text">商店暂时没有新的小丑牌可购买</text>
  </view>

  <!-- 背包面板 -->
  <view class="bag-overlay" wx:if="{{showBagPanel}}">
    <view class="bag-panel">
      <view class="bag-header">
        <text class="bag-title">背包 - 星球牌</text>
        <button class="close-btn" bindtap="closeBag">×</button>
      </view>
      <view class="bag-toolbar-row1">
        <button class="toggle-select-btn" bindtap="toggleSelectAll">{{isAllSelected ? '取消全选' : '全选'}}</button>
      </view>
      <view class="bag-toolbar-row2">
        <button class="use-btn" wx:if="{{selectedCount>0}}" bindtap="useSelectedPlanet">使用</button>
        <button class="sell-btn" wx:if="{{selectedCount>0}}" bindtap="sellSelectedPlanet">售出(<text class="gold-text">🥮{{selectedCount}}</text>)</button>
      </view>
      <view class="bag-grid">
        <block wx:for="{{bagItems}}" wx:key="id">
          <view class="bag-planet{{item.__selected?' selected':''}}" data-index="{{index}}" bindtap="toggleSelectOne">
            <view class="planet-inner small">
              <text class="planet-type">{{item.type}}</text>
              <text class="planet-level">{{item.level || 1}}</text>
            </view>
          </view>
        </block>
        <view wx:if="{{!bagItems || bagItems.length === 0}}" class="empty-tip">暂无星球牌</view>
      </view>
    </view>
  </view>
</view>

<!-- 比赛信息覆盖层（与游戏界面一致） -->
<view class="info-overlay" wx:if="{{showInfoPanel}}">
  <view class="info-panel">
    <view class="info-header">
      <button class="tab-btn{{infoActiveTab==='types' ? ' active' : ''}}" data-tab="types" bindtap="switchInfoTab">牌型</button>
      <button class="tab-btn{{infoActiveTab==='coupons' ? ' active' : ''}}" data-tab="coupons" bindtap="switchInfoTab">优惠券</button>
      <button class="close-btn" bindtap="closeInfo">×</button>
    </view>
    <view class="info-body" wx:if="{{infoActiveTab==='types'}}">
      <view class="info-table">
        <block wx:for="{{infoTypeRows}}" wx:key="type">
          <view class="info-row">
            <text class="col-level">{{item.level}}</text>
            <text class="col-type">{{item.type}}</text>
            <view class="col-product">
              <text class="chip-label">{{item.chip}}</text>
              <text class="multiply-x">✖️</text>
              <text class="multiplier-label">{{item.multiplier}}</text>
            </view>
            <text class="col-count"><text class="count-hash">#</text><text class="count-orange">{{item.playCount}}</text></text>
          </view>
        </block>
      </view>
    </view>
    <view class="info-body" wx:elif="{{infoActiveTab==='coupons'}}">
      <view class="empty-tip">暂无优惠券</view>
    </view>
  </view>
</view>

<!-- 模仿者选择器 -->
<joker-mimic-selector 
  visible="{{showMimicSelector}}" 
  availableJokers="{{availableJokersForMimic}}"
  bind:jokerSelected="onMimicJokerSelected"
  bind:cancel="onMimicSelectionCanceled"
/> 