<!-- çŠ¶æ€æ  -->
<view class="status-bar">
  <view class="status-row1">
    <view class="status-left">
      <button class="exit-btn" bindtap="exitGame">é€€å‡º</button>
    </view>
    <view class="status-right">
      <view class="triple">
        <text class="lt">{{levelType}}</text>
        <text class="mid">åº•æ³¨:{{currentBet}}/{{targetBet}}</text>
        <text class="rt">å›åˆ:{{currentRound}}</text>
      </view>
    </view>
  </view>
  <view class="status-row2">
    <button class="control-btn info-btn" bindtap="showInfo">ç‰Œå‹</button>
    <button class="control-btn bag-btn" bindtap="openBag">èƒŒåŒ…</button>
    <button class="control-btn deck-btn" bindtap="showDeck">{{remainCards}}/{{totalCards}}</button>
  </view>

  <!-- èƒŒåŒ…è¦†ç›–å±‚ -->
  <view class="bag-overlay" wx:if="{{showBagPanel}}">
    <view class="bag-panel">
      <view class="bag-header">
        <text class="gold-in-bag">ğŸ¥®{{gold}}</text>
        <text class="bag-title">èƒŒåŒ… - æ˜Ÿçƒç‰Œ</text>
        <button class="close-btn" bindtap="closeBag">Ã—</button>
      </view>
      <view class="bag-toolbar-row1">
        <button class="toggle-select-btn" bindtap="toggleSelectAll">{{isAllSelected ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}</button>
      </view>
      <view class="bag-toolbar-row2">
        <button class="use-btn" wx:if="{{selectedCount>0}}" bindtap="useSelectedPlanet">ä½¿ç”¨</button>
        <button class="sell-btn" wx:if="{{selectedCount>0}}" bindtap="sellSelectedPlanet">å”®å‡º(<text class="gold-text">ğŸ¥®{{selectedCount}}</text>)</button>
      </view>
      <view class="bag-grid">
        <block wx:for="{{9}}" wx:key="index">
          <view class="bag-slot{{bagItems[index] ? ' has-item' : ''}}">
            <view wx:if="{{bagItems[index]}}" class="bag-planet{{bagItems[index].__selected?' selected':''}}" data-index="{{index}}" bindtap="toggleSelectOne">
              <view class="planet-inner small">
                <text class="planet-type">{{bagItems[index].type}}</text>
                <text class="planet-level">{{bagItems[index].level || 1}}</text>
              </view>
            </view>
            <view wx:else class="bag-slot-empty"></view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <view class="status-row3">
    <text>ç›®æ ‡:{{scoreTarget}}</text>
    <text>å‡ºç‰Œ:{{remainPlay}}</text>
    <text>å¼ƒç‰Œ:{{remainDiscard}}</text>
  </view>
  <view class="status-row4">
    <view class="row-left">
      <text>å›åˆåˆ†æ•°: {{roundScore}}</text>
    </view>
    <view class="row-right" wx:if="{{cardType && cardType !== ''}}">
      <view class="card-type-info">
        <text class="normal-style">{{cardType}}</text>
        <text class="shadow-style">ç­‰çº§{{cardGrade}}</text>
        <text class="count-hash">#</text><text class="count-orange">{{cardCount}}</text>
      </view>
    </view>
  </view>
  <view class="status-row5">
    <view class="row-left">
      <text class="gold-text">ğŸ¥®{{gold}}</text>
    </view>
    <view class="row-right" wx:if="{{cardType && cardType !== ''}}">
      <text class="chip-label">{{currentChip}}</text>
      <text class="multiply-label">Ã—</text>
      <text class="multiplier-label">{{currentMultiplier}}</text>
      <text class="equals-label">=</text>
      <text class="product-label">{{currentChip * currentMultiplier}}</text>
    </view>
  </view>
  <view class="status-row6">
  </view>
</view>

<!-- å°ä¸‘ç‰ŒåŒº -->
<joker-strip id="joker-strip" jokers="{{jokerCards}}" maxSlots="7" abstractJokerBonus="{{abstractJokerBonus}}" tapEnabled="{{true}}" alignMode="left" bind:tap="showJokerDetailFromStrip" />

<!-- å°ä¸‘ç‰Œè¯¦æƒ…å¼¹æ¡† -->
<view class="joker-detail-overlay" wx:if="{{showJokerDetail}}">
  <view class="joker-detail-panel">
    <view class="joker-detail-header">
      <text class="joker-detail-title">{{currentJoker.name}}</text>
      <button class="close-btn" bindtap="closeJokerDetail">Ã—</button>
    </view>
    <view class="joker-detail-content">
      <view class="joker-detail-rarity" style="background-color: {{currentJoker.backgroundColor}}; color: {{currentJoker.textColor}};">
        {{currentJoker.rarity}}
      </view>
      <view class="joker-detail-effect">
        {{currentJoker.effect}}
      </view>
    </view>
    <view class="joker-detail-footer">
      <button class="sell-joker-btn" bindtap="sellJoker">
        å‡ºå”®(<text class="gold-text">ğŸ¥®{{currentJoker.sellPrice}}</text>)
      </button>
    </view>
  </view>
</view>

<!-- å‡ºç‰ŒåŒº -->
<view class="played-area">
  <block wx:for="{{5|range}}" wx:for-index="idx" wx:key="idx">
    <view class="played-card{{scoreCards[idx].isValid ? ' valid-card' : ''}}{{scoreCards[idx].colorState ? ' ' + scoreCards[idx].colorState : ''}}" wx:if="{{scoreCards[idx]}}" data-index="{{idx}}">
      <view class="card-content">
        <view class="card-suit">{{scoreCards[idx].suit}}</view>
        <view class="card-point">{{scoreCards[idx].point}}</view>
      </view>
      <view class="debug-info" style="font-size: 8rpx; color: red;">{{scoreCards[idx].isValid ? 'V' : 'X'}}</view>
    </view>
    <view class="played-card-back" wx:else></view>
  </block>
</view>

<!-- æ“ä½œæŒ‰é’®åŒº -->
<view class="action-btns">
  <button class="play-btn{{!hasSelectedCards ? ' disabled' : ''}}" bindtap="playCard" disabled="{{!hasSelectedCards}}">å‡ºç‰Œ</button>
  <button class="point-btn" bindtap="sortByPoint">
    <view class="indicator{{sortMode === 'point' ? ' active' : ''}}"></view>
    ç‚¹æ•°
  </button>
  <button class="suit-btn" bindtap="sortBySuit">
    <view class="indicator{{sortMode === 'suit' ? ' active' : ''}}"></view>
    èŠ±è‰²
  </button>
  <button class="discard-btn{{(!hasSelectedCards || remainDiscard <= 0) ? ' disabled' : ''}}" bindtap="discardCard" disabled="{{!hasSelectedCards || remainDiscard <= 0}}">å¼ƒç‰Œ</button>
</view>

<!-- æ‰‹ç‰ŒåŒºï¼š6è¡Œ5åˆ—å…±30ä¸ªè“è‰²æ¡çº¹èƒŒé¢å¡ç‰Œ -->
<view class="hand-area-outer">
  <view class="hand-count">{{currentHandCount}}/{{handLimit}}</view>
  <view class="hand-area">
    <block wx:for="{{4|range}}" wx:for-index="rowIdx" wx:key="rowIdx">
      <view class="hand-row">
        <block wx:for="{{7|range}}" wx:for-index="slotIdx" wx:key="slotIdx">
          <block wx:if="{{handRows[rowIdx][slotIdx] && handRows[rowIdx][slotIdx].back}}">
            <view class="hand-card-back"></view>
          </block>
          <block wx:elif="{{handRows[rowIdx][slotIdx] && handRows[rowIdx][slotIdx].suit}}">
            <view class="hand-card{{selectedCards[rowIdx][slotIdx] ? ' selected' : ''}}" bindtap="onCardBackTap" data-rowidx="{{rowIdx}}" data-slotidx="{{slotIdx}}">
              <view class="card-content">
                <view class="card-suit">{{handRows[rowIdx][slotIdx].suit}}</view>
                <view class="card-point">{{handRows[rowIdx][slotIdx].point}}</view>
              </view>
            </view>
          </block>
          <block wx:else>
            <view class="hand-card-back"></view>
          </block>
        </block>
      </view>
    </block>
  </view>
</view>

<!-- ç»“ç®—é¢æ¿ -->
<view class="settlement-panel" wx:if="{{showSettlement}}">
  <view class="settlement-content">
    <view class="settlement-title">å›åˆèƒœåˆ©ï¼</view>
    <view class="settlement-info">
      <text>å›åˆåˆ†æ•°: {{roundScore}}</text>
      <text>ç›®æ ‡åˆ†æ•°: {{scoreTarget}}</text>
      <text>é€šå…³å¥–åŠ±: <text class="gold-text">ğŸ¥®{{levelReward}}</text></text>
      <text>é€Ÿèƒœå¥–åŠ±: <text class="gold-text">ğŸ¥®{{remainPlay}}</text></text>
      <text>åˆ©æ¯: <text class="gold-text">ğŸ¥®{{interest}}</text></text>
      <text>è·å¾—é‡‘å¸: <text class="gold-text">ğŸ¥®{{totalReward}}</text></text>
    </view>
    <view class="settlement-buttons">
      <button class="shop-btn" bindtap="enterShop">è¿›å…¥å•†åº—</button>
    </view>
  </view>
</view>

<!-- æ¯”èµ›ä¿¡æ¯è¦†ç›–å±‚ -->
<view class="info-overlay" wx:if="{{showInfoPanel}}">
  <view class="info-panel">
    <view class="info-header">
      <text class="panel-title">ç‰Œå‹</text>
      <button class="close-btn" bindtap="closeInfo">Ã—</button>
    </view>
    <view class="info-body">
      <view class="info-table">
        <block wx:for="{{infoTypeRows}}" wx:key="type">
          <view class="info-row">
            <text class="col-level">{{item.level}}</text>
            <text class="col-type">{{item.type}}</text>
            <view class="col-product">
              <text class="chip-label">{{item.chip}}</text>
              <text class="multiply-x">âœ–ï¸</text>
              <text class="multiplier-label">{{item.multiplier}}</text>
            </view>
            <text class="col-count"><text class="count-hash">#</text><text class="count-orange">{{item.playCount}}</text></text>
          </view>
        </block>
      </view>
    </view>
  </view>
</view>

<!-- ç‰Œç»„å›¾å±‚ -->
<view class="deck-overlay" wx:if="{{showDeckPanel}}">
  <view class="deck-panel">
    <view class="deck-header">
      <text class="panel-title">ç‰Œç»„</text>
      <button class="close-btn" bindtap="closeDeck">Ã—</button>
    </view>
    <view class="deck-body">
      <view class="deck-grid">
        <block wx:for="{{deckDisplay}}" wx:key="point">
          <view class="deck-row">
            <text class="deck-point-label">{{item.point}}</text>
            <view class="deck-cards">
              <block wx:for="{{item.cards}}" wx:key="index" wx:for-item="card">
                <view class="deck-card {{card.status}}" style="z-index: {{index}};">
                  <view class="deck-card-content">
                    <view class="deck-card-suit">{{card.suit}}</view>
                    <view class="deck-card-point">{{card.point}}</view>
                  </view>
                </view>
              </block>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>
</view> 